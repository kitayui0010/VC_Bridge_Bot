# VC_Bridge_Bot

Discord Voice Bridge Bot
このプロジェクトは、2つのDiscordボット（送信側と受信側）を使って、Discordのボイスチャンネル間で音声をリアルタイムに中継するシステムです。異なるVC間の音声共有や、特定のVCの音声を別のVCで聞くといった用途に利用できます。

このプロジェクトのコードは、AIによって生成されました。

概要
本システムは以下の2つの主要なNode.jsスクリプトで構成されています。

vc_s.js (送信側ボット):

指定されたDiscordサーバーのボイスチャンネルからユーザーの音声ストリームを受信します。
受信した音声を、TCPソケットを介して受信側ボットにリアルタイムで転送します。
ENABLE_VC_MONITORING 環境変数を true に設定すると、設定されたカテゴリ内で最も人数が多いボイスチャンネルに自動的に接続・移動します。
VCからの切断時や移動時に自動再接続を試みます。
ボットがサーバーミュートまたはサーバーデフンにされた場合、自動的に解除を試みます。
vc_j.js (受信側ボット):

TCPソケットを介して送信側ボットから音声データを受信します。
受信したOpusデータをデコードし、指定されたDiscordサーバーのボイスチャンネルで再生します。
VCから切断された際に自動再接続を試みます。
ボットがサーバーミュートまたはサーバーデフンにされた場合、自動的に解除を試みます。
特徴
リアルタイム音声中継: 低遅延でDiscord VC間の音声を共有します。
動的なVC選択 (送信側): 参加人数に応じて最もアクティブなVCへ自動で移動する機能（任意で有効/無効化可能）.
自動再接続・ミュート解除: 安定稼働のための再接続機能と、ボットのミュート状態自動解除.
簡単な設定: すべての設定は.envファイルを通じて行われるため、コードの変更は不要です。
必要なもの
Node.js (v16.9.0 以降を推奨)
Discord Botアカウント (送信側と受信側でそれぞれ1つずつ)
Discordサーバー (ギルド) のID
ボイスチャンネルのID
ボイスチャンネルのカテゴリID (送信側ボットのVC移動機能を使用する場合)
セットアップ手順
1. リポジトリのクローン
まず、このリポジトリをあなたのローカル環境にクローンします。

Bash

git clone https://github.com/your-username/Discord-Voice-Bridge-Bot.git
cd Discord-Voice-Bridge-Bot
2. 依存関係のインストール
プロジェクトに必要なNode.jsパッケージをインストールします。

Bash

npm install
3. .envファイルの作成と設定
プロジェクトのルートディレクトリに、環境変数を設定するための.envファイルを作成します。このファイルには機密情報が含まれるため、GitHubなどの公開リポジトリには絶対に含めないでください。

配布されている_example.envファイルをコピーして.envにリネームし、以下の項目をご自身の情報に置き換えてください。

.env の例:

Ini, TOML

# このファイルを .env にリネームして使用してください。
# 機密情報が含まれるため、Git管理 (GitHubなど) に含めないでください。

# --- ボットのトークン ---
# Discord Developer Portalで取得した各ボットのトークン
SENDER_BOT_TOKEN=YOUR_SENDER_BOT_TOKEN_HERE
RECEIVER_BOT_TOKEN=YOUR_RECEIVER_BOT_TOKEN_HERE

# --- サーバー情報 ---
# ボットが参加するDiscordサーバーのID (開発者モードでサーバー名を右クリックし「IDをコピー」)
GUILD_ID=YOUR_GUILD_ID_HERE

# --- ボイスチャンネルID ---
# 音声を取得するVCのID (開発者モードでVC名を右クリックし「IDをコピー」)
SOURCE_VC_ID=YOUR_SOURCE_VOICE_CHANNEL_ID_HERE  
# 音声を再生するVCのID (開発者モードでVC名を右クリックし「IDをコピー」)
DEST_VC_ID=YOUR_DESTINATION_VOICE_CHANNEL_ID_HERE   
# VC人数監視の対象カテゴリID (VC移動機能を使う場合必須。開発者モードでカテゴリ名を右クリックし「IDをコピー」)
SOURCE_CATEGORY_ID=YOUR_SOURCE_CATEGORY_ID_HERE

# --- 受信側接続設定 ---
# 受信側ボットが動作するPCのIPアドレス (同じPCなら127.0.0.1、異なるPCならそのPCのIPアドレス)
RECEIVER_HOST=127.0.0.1
# ボット間通信に使用するポート番号 (通常は50000のままでOK)
RECEIVER_PORT=50000

# --- VC人数による移動機能 ---
# true: VC人数が多いチャンネルへ自動移動を有効にする / false: 移動しない
ENABLE_VC_MONITORING=true
DiscordのID取得方法:
Discordクライアントの設定で「詳細設定」から「開発者モード」を有効にすると、サーバー、チャンネル、ユーザーなどを右クリックして「IDをコピー」できるようになります。

4. ボットの起動
必ず受信側ボット (vc_j.js) を先に起動してください。

受信側ボットを起動:

Bash

node vc_j.js
受信: サーバー起動 と表示されれば成功です。

送信側ボットを起動:

Bash

node vc_s.js
送信: Bot起動完了 と表示され、指定されたVCに接続すれば成功です。

両方のボットが起動し、指定されたボイスチャンネルに接続すると、音声の中継が開始されます。

注意事項
ポート開放: 送信側と受信側ボットが異なるPCで動作する場合、RECEIVER_PORT で指定したポートが受信側ボットのPCで正しく開放されていることを確認してください（ファイアウォールやルーターの設定）。
ボットの権限: ボットがボイスチャンネルへの接続、音声の再生、メンバーの移動（送信側）に必要な権限をDiscordサーバー上で持っていることを確認してください。
ネットワーク帯域: 音声データをリアルタイムで転送するため、安定したネットワーク接続と十分な帯域幅が必要です。
.gitignore: プロジェクト内の.gitignoreファイルには.envが記述されています。これにより、Gitにコミットされることを防ぎ、機密情報の漏洩を防ぎます。

ソース





@echo off

REM 環境変数を書き換える場合は .env ファイルを編集してください



REM 英語パスの作業ディレクトリに移動

cd /d C:\VCproject



REM ウィンドウタイトルを明示的に指定して起動

start "receiver" cmd /k node vc_j.js

start "sender" cmd /k node vc_s.js





あと起動用のBATファイルを同梱しておいた



起動用のBATファイルを含めることも可能です。これにより、ユーザーはコマンドプロンプトから手動でコマンドを入力することなく、簡単にボットを起動できるようになります。

提供されたBATファイルを元に、READMEの「4. ボットの起動」セクションを更新します。

Discord Voice Bridge Bot
このプロジェクトは、2つのDiscordボット（送信側と受信側）を使って、Discordのボイスチャンネル間で音声をリアルタイムに中継するシステムです。異なるVC間の音声共有や、特定のVCの音声を別のVCで聞くといった用途に利用できます。

このプロジェクトのコードは、AIによって生成されました。

概要
本システムは以下の2つの主要なNode.jsスクリプトで構成されています。

vc_s.js (送信側ボット):

指定されたDiscordサーバーのボイスチャンネルからユーザーの音声ストリームを受信します.
受信した音声を、TCPソケットを介して受信側ボットにリアルタイムで転送します.
ENABLE_VC_MONITORING 環境変数を true に設定すると、設定されたカテゴリ内で最も人数が多いボイスチャンネルに自動的に接続・移動します.
VCからの切断時や移動時に自動再接続を試みます.
ボットがサーバーミュートまたはサーバーデフンにされた場合、自動的に解除を試みます.
vc_j.js (受信側ボット):

TCPソケットを介して送信側ボットから音声データを受信します.
受信したOpusデータをデコードし、指定されたDiscordサーバーのボイスチャンネルで再生します.
VCから切断された際に自動再接続を試みます.
ボットがサーバーミュートまたはサーバーデフンにされた場合、自動的に解除を試みます.
特徴
リアルタイム音声中継: 低遅延でDiscord VC間の音声を共有します。
動的なVC選択 (送信側): 参加人数に応じて最もアクティブなVCへ自動で移動する機能（任意で有効/無効化可能）。
自動再接続・ミュート解除: 安定稼働のための再接続機能と、ボットのミュート状態自動解除。
簡単な設定: すべての設定は.envファイルを通じて行われるため、コードの変更は不要です。
必要なもの
Node.js (v16.9.0 以降を推奨)
Discord Botアカウント (送信側と受信側でそれぞれ1つずつ)
Discordサーバー (ギルド) のID
ボイスチャンネルのID
ボイスチャンネルのカテゴリID (送信側ボットのVC移動機能を使用する場合)
セットアップ手順
1. リポジトリのクローン
まず、このリポジトリをあなたのローカル環境にクローンします。

Bash

git clone https://github.com/your-username/Discord-Voice-Bridge-Bot.git
cd Discord-Voice-Bridge-Bot
2. 依存関係のインストール
プロジェクトに必要なNode.jsパッケージをインストールします。

Bash

npm install
3. .envファイルの作成と設定
プロジェクトのルートディレクトリに、環境変数を設定するための.envファイルを作成します。このファイルには機密情報が含まれるため、GitHubなどの公開リポジトリには絶対に含めないでください。

配布されている_example.envファイルをコピーして.envにリネームし、以下の項目をご自身の情報に置き換えてください。

.env の例:

Ini, TOML

# このファイルを .env にリネームして使用してください。
# 機密情報が含まれるため、Git管理 (GitHubなど) に含めないでください。

# --- ボットのトークン ---
# Discord Developer Portalで取得した各ボットのトークン
SENDER_BOT_TOKEN=YOUR_SENDER_BOT_TOKEN_HERE
RECEIVER_BOT_TOKEN=YOUR_RECEIVER_BOT_TOKEN_HERE

# --- サーバー情報 ---
# ボットが参加するDiscordサーバーのID (開発者モードでサーバー名を右クリックし「IDをコピー」)
GUILD_ID=YOUR_GUILD_ID_HERE

# --- ボイスチャンネルID ---
# 音声を取得するVCのID (開発者モードでVC名を右クリックし「IDをコピー」)
SOURCE_VC_ID=YOUR_SOURCE_VOICE_CHANNEL_ID_HERE  
# 音声を再生するVCのID (開発者モードでVC名を右クリックし「IDをコピー」)
DEST_VC_ID=YOUR_DESTINATION_VOICE_CHANNEL_ID_HERE   
# VC人数監視の対象カテゴリID (VC移動機能を使う場合必須。開発者モードでカテゴリ名を右クリックし「IDをコピー」)
SOURCE_CATEGORY_ID=YOUR_SOURCE_CATEGORY_ID_HERE

# --- 受信側接続設定 ---
# 受信側ボットが動作するPCのIPアドレス (同じPCなら127.0.0.1、異なるPCならそのPCのIPアドレス)
RECEIVER_HOST=127.0.0.1
# ボット間通信に使用するポート番号 (通常は50000のままでOK)
RECEIVER_PORT=50000

# --- VC人数による移動機能 ---
# true: VC人数が多いチャンネルへ自動移動を有効にする / false: 移動しない
ENABLE_VC_MONITORING=true
DiscordのID取得方法:
Discordクライアントの設定で「詳細設定」から「開発者モード」を有効にすると、サーバー、チャンネル、ユーザーなどを右クリックして「IDをコピー」できるようになります。

4. ボットの起動
同梱されている start_bots.bat ファイルを使用すると、簡単にボットを起動できます。

start_bots.bat ファイルを編集:

start_bots.bat をテキストエディタで開き、cd /d C:\VCproject の部分を、このプロジェクトのフォルダのパスに書き換えてください。 例: もしプロジェクトが D:\DiscordBots\VoiceBridge にある場合、cd /d D:\DiscordBots\VoiceBridge とします。
start_bots.bat を実行:

start_bots.bat をダブルクリックして実行します。
受信側ボットと送信側ボットがそれぞれ別のコマンドプロンプトウィンドウで起動します。
受信: サーバー起動、受信: VC接続完了、送信: Bot起動完了 と表示され、指定されたVCに接続すれば成功です。
手動で起動する場合:

必ず受信側ボット (vc_j.js) を先に起動してください。

受信側ボットを起動:

Bash

node vc_j.js
送信側ボットを起動:

Bash

node vc_s.js
両方のボットが起動し、指定されたボイスチャンネルに接続すると、音声の中継が開始されます。

注意事項
ポート開放: 送信側と受信側ボットが異なるPCで動作する場合、RECEIVER_PORT で指定したポートが受信側ボットのPCで正しく開放されていることを確認してください（ファイアウォールやルーターの設定）。
ボットの権限: ボットがボイスチャンネルへの接続、音声の再生、メンバーの移動（送信側）に必要な権限をDiscordサーバー上で持っていることを確認してください。
ネットワーク帯域: 音声データをリアルタイムで転送するため、安定したネットワーク接続と十分な帯域幅が必要です。
.gitignore: プロジェクト内の.gitignoreファイルには.envが記述されています。これにより、Gitにコミットされることを防ぎ、機密情報の漏洩を防ぎます。
同梱する start_bots.bat ファイルの内容:

コード スニペット

@echo off
REM 環境変数を書き換える場合は .env ファイルを編集してください

REM 英語パスの作業ディレクトリに移動
REM ここをこのプロジェクトのフォルダのパスに書き換えてください
cd /d C:\VCproject

REM ウィンドウタイトルを明示的に指定して起動
start "Receiver Bot" cmd /k node vc_j.js
start "Sender Bot" cmd /k node vc_s.js
